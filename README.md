# 5-Step AI Debate System with Script-Format Analysis

## 🎯 概要

このプロジェクトは、**5ステップ構造**と**台本形式分析レポート**を特徴とする次世代AIディベートシステムです。メッセージブローカーを通じて7つのAIエージェントが協調し、学術的に正確で感情豊かなディベートを実現します。

## ✨ 主要機能

### 🏛️ 完全5ステップディベート構造
1. **立論** (Opening Statements) - 各陣営の基本主張
2. **反対尋問** (Cross-Examination) - 相手への質問と追及  
3. **反駁** (Rebuttals) - 相手論点への直接反論
4. **最終弁論** (Closing Statements) - 総括と最終訴え
5. **判定** (Judgement) - 3名のジャッジによる総合評価

### 🎭 台本形式分析レポート
- **リアルな進行記録**: 実際のディベートの様子を完全再現
- **キャラクター表現**: 各エージェントが個性豊かに発言
- **教育価値**: ディベートの進行方法と構造を学習可能

### ⚖️ 高度な評価システム
- **5項目評価**: 論理性、証拠、反対尋問、反駁、最終弁論（各10点満点）
- **多角的判定**: 論理重視、感情重視、バランス重視の3つの視点
- **詳細スコアリング**: 50点満点での包括的評価

## 🚀 主要コンポーネント

### 1. 統一オーケストレーションシステム
- **`run_debate.sh`**: 完全統合された5ステップディベート実行スクリプト
- **リアルタイム監視**: 進行状況、メッセージ統計、エージェント状態の表示
- **エラーハンドリング**: システムワイドなエラー検出と適切な終了処理

### 2. SQLiteメッセージブローカー
- **`message_broker.py`**: 非同期メッセージング基盤
- **永続化**: 全メッセージ履歴の完全記録
- **統計機能**: リアルタイムでの処理状況把握

### 3. 高度なエージェントシステム
- **`agent_main.py`**: Gemini API統合によるインテリジェントな議論生成
- **専門化**: 各エージェントの役割特化と個性表現
- **エラー耐性**: システムエラー時の適切な処理と通知

## 🤖 エージェント構成

| エージェント | 役割 | 専門性 |
|-------------|------|--------|
| **MODERATOR** | 司会進行 | ディベートフロー管理 |
| **DEBATER_A** | 肯定側討論者 | 論理的実証アプローチ |
| **DEBATER_N** | 否定側討論者 | 価値観・感情訴求アプローチ |
| **JUDGE_L** | 論理性審査員 | 論理構造・整合性評価 |
| **JUDGE_E** | 感情訴求審査員 | 説得力・感情的影響評価 |
| **JUDGE_R** | バランス審査員 | 総合的・調和的評価 |
| **ANALYST** | 分析レポーター | 台本形式レポート生成 |

## 📦 クイックスタート

### 🎬 基本実行（推奨）
```bash
./run_debate.sh
```

### ⚙️ 高度な設定オプション
```bash
# カスタムタイムアウト設定（デフォルト: 15分）
TIMEOUT_DURATION=1200 ./run_debate.sh  # 20分

# カスタムトピック設定
TOPIC="人工知能の倫理規制について" ./run_debate.sh

# デバッグモード
DEBUG=1 ./run_debate.sh
```

### 🧪 システムテスト
```bash
# メッセージブローカーの動作確認
python3 test_message_broker.py

# データベース状態確認
python3 message_broker.py --stats

# ログファイル分析
tail -f debate_runs/latest/MODERATOR.log
```

## 📊 システム監視と結果分析

### リアルタイム統計
実行中に以下の情報をリアルタイムで確認可能：
- **メッセージ処理数**: 現在の処理状況
- **エージェント状態**: 各エージェントの動作状況  
- **ディベートフェーズ**: 現在のステップ進行状況
- **システムリソース**: CPU・メモリ使用状況

### 詳細統計分析
```bash
cd debate_runs/[DEBATE_ID]
python3 ../message_broker.py stats
```

### ログファイル構造
```
debate_runs/[TIMESTAMP]/
├── MODERATOR.log    # 司会進行ログ
├── DEBATER_A.log    # 肯定側ログ  
├── DEBATER_N.log    # 否定側ログ
├── JUDGE_L.log      # 論理審査ログ
├── JUDGE_E.log      # 感情審査ログ
├── JUDGE_R.log      # バランス審査ログ
├── messages.db      # 全メッセージ履歴
└── debate_analysis_report.md  # 台本形式最終レポート
```

## 🎯 出力レポート形式

### 台本形式分析レポート
最終レポートは実際のディベートの様子を完全再現した台本形式で生成されます：

```markdown
# 台本：AIディベート - [テーマ]

## 第1幕：立論
**司会者**: 「それでは、AIの社会導入に関するディベートを開始いたします...」

**肯定側（田中）**: 「皆様、本日は貴重なお時間をいただき...」
- 効率性の向上による生産性向上
- 人間のミスを減らす安全性向上

**否定側（佐藤）**: 「確かに効率性は重要ですが、しかし...」
- 雇用への深刻な影響
- 人間性の喪失リスク

## 第2幕：反対尋問  
**肯定側**: 「佐藤さんにお聞きしたいのですが...」

## 評価結果
- **論理性**: 8点/10点
- **証拠力**: 7点/10点  
- **総合評価**: 42点/50点
```

## 🔧 技術仕様とアーキテクチャ

### システム要件
- **Python 3.8+**: 基本実行環境
- **SQLite3**: メッセージ永続化
- **Gemini API**: AIエージェント駆動（APIキー必要）
- **Bash**: オーケストレーション（Linux/macOS/WSL）

### パフォーマンス指標
- **並行処理**: 7エージェント同時実行
- **スケーラビリティ**: 50+メッセージ処理確認済み
- **応答性**: ステップ間平均30秒遷移
- **安定性**: 15分間継続実行テスト済み

### API統合
- **Gemini Pro**: メイン推論エンジン
- **タイムアウト処理**: 30秒でエラーハンドリング
- **レート制限**: 適切な間隔での API呼び出し
- **エラー回復**: ネットワーク障害時の自動復旧

### ✅ 統合完了項目
- **5ステップディベート構造**: Opening → Cross-Examination → Rebuttals → Closing → Judgement
- **台本形式レポート**: 実際のディベート進行を演劇脚本として再現
- **統一オーケストレーション**: `run_debate.sh` による完全統合実行
- **SQLiteメッセージブローカー**: 非同期メッセージング基盤
- **リアルタイム監視**: 進行状況とシステム状態の可視化
- **堅牢なエラーハンドリング**: プロセス管理とクリーンアップ
- **詳細な統計分析**: メッセージ分析とパフォーマンス計測
- **高度な評価システム**: 5項目50点満点の包括的評価

## 📁 ファイル構造

```
/app/
├── run_debate.sh              # 🎯 統一メインスクリプト（5ステップ対応）
├── message_broker.py          # 📬 SQLiteメッセージブローカー
├── agent_main.py              # 🤖 エージェントメイン（完全リライト）
├── test_message_broker.py     # 🧪 システム統合テスト
├── config/                    # ⚙️ エージェント設定
│   ├── debate_system.md       # 🏛️ 5ステップルール定義
│   ├── moderator.md           # 司会進行設定
│   ├── debater_a.md          # 肯定側設定
│   ├── debater_n.md          # 否定側設定
│   ├── judge_l.md            # 論理審査員設定
│   ├── judge_e.md            # 感情審査員設定
│   ├── judge_r.md            # バランス審査員設定
│   └── analyst.md            # 分析レポーター設定
├── debate_runs/               # 📊 実行結果
│   └── [TIMESTAMP]/           # タイムスタンプ別フォルダ
│       ├── *.log             # 各エージェントログ
│       ├── messages.db       # メッセージ履歴
│       └── debate_analysis_report.md  # 台本形式レポート
└── docs/                      # 📚 ドキュメント
```

## 🎓 教育価値と活用

### 学習効果
- **ディベート技法**: 5ステップ構造の実践的学習
- **論理思考**: 立論・反駁・尋問の技術習得
- **評価基準**: 多角的評価システムの理解
- **システム設計**: 分散メッセージングアーキテクチャ

### カスタマイズ可能要素
- **トピック設定**: 任意のディベートテーマ
- **エージェント個性**: `config/`フォルダでの詳細設定
- **評価基準**: 審査員の重視項目カスタマイズ
- **時間制限**: フェーズごとの時間調整

## 🚀 発展的機能（近日実装予定）

### UI/UX改善
- **Web UI**: ブラウザベースのリアルタイム視聴
- **音声合成**: エージェント発言の音声化
- **視覚化**: ディベートフローの動的表示

### 多様性拡張
- **多言語対応**: 英語・中国語でのディベート
- **チーム戦**: 3対3のチームディベート形式
- **テーマ特化**: 法律・医療・技術専門ディベート

### 一般的な問題と解決策

#### � "No API key" エラー
```bash
export GEMINI_API_KEY="your_api_key_here"
./run_debate.sh
```

#### 🔄 プロセスが残る場合
```bash
# 残存プロセスの確認と終了
ps aux | grep "agent_main.py"
killall python3
```

#### 📊 メッセージブローカーの状態確認
```bash
# データベース状態
python3 message_broker.py --stats

# データベースのリセット
rm messages.db
```

#### 🐛 デバッグモード実行
```bash
DEBUG=1 ./run_debate.sh
```

## 🤝 コミュニティ貢献

### 貢献方法
- **Issue報告**: バグ報告・機能要望歓迎
- **Pull Request**: コード貢献・改善提案
- **ドキュメント**: 使用例・ベストプラクティス共有
- **教材作成**: 教育現場での活用事例

### 開発ガイドライン
- **コードスタイル**: PEP 8準拠
- **テスト**: 新機能には適切なテストを追加
- **ドキュメント**: コメントと README更新を徹底
- **互換性**: Python 3.8+での動作保証

---

## 📝 ライセンス

このプロジェクトはMITライセンスのもとで公開されています。詳細は[LICENSE](LICENSE)ファイルをご覧ください。

---

**🎭 "The future of education is not just learning facts, but learning to think, argue, and persuade." - AI Debate System Team**

### エージェントが応答しない場合
```bash
# プロセス確認
ps aux | grep agent_main.py

# ログ確認  
tail -f debate_runs/[DEBATE_ID]/[AGENT].log
```

### メッセージ配信の問題
```bash
# メッセージ状況確認
DEBATE_DIR=./debate_runs/[DEBATE_ID] python3 message_broker.py stats
```

## 設定のカスタマイズ

### タイムアウト時間
```bash
export TIMEOUT_DURATION=1800  # 30分
./run_debate.sh
```

### エージェント設定
`config/` ディレクトリ内の各エージェント設定ファイルを編集してください。

## 詳細ドキュメント

- **統合ガイド**: `MESSAGE_BROKER_INTEGRATION.md`
- **最適化マニュアル**: `OPTIMIZATION_MANUAL.md`

---

**🎉 メッセージブローカー統合により、スケーラブルで堅牢なAIディベートシステムが実現されました！**
